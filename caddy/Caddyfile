{
    acme_dns cloudflare {env.CLOUDFLARE_API_TOKEN}
}

# --- Media Server ---
plex.{$DOMAIN} {
    reverse_proxy host.docker.internal:32400
}

# --- Management ---
sonarr.{$DOMAIN} {
    reverse_proxy sonarr:8989
}

radarr.{$DOMAIN} {
    reverse_proxy radarr:7878
}

prowlarr.{$DOMAIN} {
    reverse_proxy prowlarr:9696
}

bazarr.{$DOMAIN} {
    reverse_proxy bazarr:6767
}

# --- Downloaders ---
qbit.{$DOMAIN} {
    reverse_proxy qbittorrent:8080
}

audio.{$DOMAIN} {
    reverse_proxy audiobookshelf:80
}

# --- Requests ---
overseerr.{$DOMAIN} {
    reverse_proxy overseerr:5055
}

# --- Stats & Dashboard ---
tautulli.{$DOMAIN} {
    reverse_proxy tautulli:8181
}

home.{$DOMAIN} {
    reverse_proxy homepage:3000
}

# --- Monitoring ---
status.{$DOMAIN} {
    reverse_proxy uptime-kuma:3001
}

grafana.{$DOMAIN} {
    reverse_proxy grafana:3000
}

prometheus.{$DOMAIN} {
    reverse_proxy host.docker.internal:9090
}

loki.{$DOMAIN} {
    reverse_proxy loki:3100
}

# --- Control Plane ---
stack.{$DOMAIN} {
    reverse_proxy host.docker.internal:3005
}

api.{$DOMAIN} {
    reverse_proxy host.docker.internal:3006 {
        # WebSocket support is automatic in Caddy v2
        # But we need to ensure proper headers are passed
        transport http {
            # Enable WebSocket upgrades
        }
    }
}
